#!/bin/bash

input_file="Internet_stat_112025_MCN"
output_file="MCN_Internet_112025"

# Проверка существования входного файла
if [ ! -f "$input_file" ]; then
    echo "Ошибка: входной файл $input_file не найден!"
    exit 1
fi

# Очистка выходного файла перед записью
> "$output_file"

# Функция конвертации в МБ с округлением
convert_to_mb() {
    local value=$1
    local num=$(echo "$value" | grep -oE '^[0-9]+(\.[0-9]+)?')
    local unit=$(echo "$value" | grep -oE '[КМГ]Б$')

    case $unit in
        "КБ")
            echo "1"
            ;;
        "МБ")
            rounded=$(printf "%.0f" "$num")
            echo "${rounded}"
            ;;
        "ГБ")
            mb=$(echo "$num * 1024" | bc -l)
            rounded=$(printf "%.0f" "$mb")
            echo "${rounded}"
            ;;
        *)
            echo "$value"
            ;;
    esac
}

# Обработка файла
while IFS= read -r line; do
    # Пропускаем пустые строки
    [ -z "$line" ] && continue
    
    # Разделение на столбцы
    account=$(echo "$line" | awk '{print $1}')
    traffic=$(echo "$line" | awk '{$1=""; print $0}' | sed 's/^ //')
    
    # Конвертация и запись результата
    if [ -n "$traffic" ]; then
        new_traffic=$(convert_to_mb "$traffic")
        echo "$account $new_traffic" >> "$output_file"
    else
        echo "$line" >> "$output_file"
    fi
done < "$input_file"

echo "Конвертация завершена. Результат сохранен в $output_file"

